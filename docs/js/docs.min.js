var contentNavigator={navigate:function(e,t){return""!=e&&"#"!=e?($.get(e,{hideIndex:1},function(o){return"error"==o.type?($("#docs-resource-content").html('<div class="text-center"><span class="label label-danger">'+o.message+"</span></div>"),!1):(t&&window.history.pushState({},"",e),$("html title").html(o.title),$("#docs-resource-content").html(o.content),void 0!=Prism&&$("pre > code").each(function(){Prism.highlightElement($(this)[0],!0)}),contentNavigator.navigation(o.id),void $("#docs-resource-index a").trigger("update"))},"json"),!1):void 0},navigation:function(e){var t,o,n=$("#docs-resource-index ul li"),a=n.length,r=!1;for(i=0;i<a;i++){if(r){o=$(n[i]).find("a").attr("href");break}var d=$("#docs-resource-index ul li[data-section='"+e+"']"),s=$(d).parents("li[data-parent='root']");s.length>0&&($(s).hasClass("expanded")||contentNavigator.expand($(s))),$(n).removeClass("current"),$("#docs-resource-index ul li[data-section='"+e+"']").addClass("current"),$(n[i]).data("section")==e?r=!0:t=$(n[i]).find("a").attr("href")}void 0!=t?$(".docs-content-article .previous").attr("href",t):$(".docs-content-article .previous").hide(),void 0!=o?$(".docs-content-article .next").attr("href",o):$(".docs-content-article .next").hide()},dialogMessage:function(e,t,o){var n=$("#"+e+" .cu-dialog-content");if(n.length<=0)return!1;var i='<div class="docs-dialog-message alert alert-'+o+'"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>'+t+"</div>";n.find(".docs-dialog-message").remove(),n.append(i),n.find(".docs-dialog-message").fadeIn(250)},getSelection:function(e){var t=document.getElementById(e),o="";if("selectionStart"in t)t.selectionStart!=t.selectionEnd&&(o=t.value.substring(t.selectionStart,t.selectionEnd));else{var n=document.selection.createRange(),i=n.parentElement();i===t&&(o=n.text)}return o},insertContent:function(e,t){if(myField=document.getElementById(e),document.selection)myField.focus(),sel=document.selection.createRange(),sel.text=t,myField.focus();else if(myField.selectionStart||"0"==myField.selectionStart){var o=myField.selectionStart,n=myField.selectionEnd,i=myField.scrollTop;myField.value=myField.value.substring(0,o)+t+myField.value.substring(n,myField.value.length),myField.focus(),myField.selectionStart=o+t.length,myField.selectionEnd=o+t.length,myField.scrollTop=i}else myField.value+=t,myField.focus()},insertIntoEditor:function(editor,type,text){if("tiny"==type){if(void 0==tinyMCE)return!1;var ed=tinyMCE.activeEditor;ed.execCommand("mceInsertContent",!0,text),ed.save()}else if("markdown"==type){if(void 0==typeof mdEditor)return!1;mdEditor.insert(editor,text,this.getEditorSelection(editor,type))}else if("html"==type){if(void 0==typeof edInsertContent)return!1;edInsertContent(editor,html)}else if("simple"==type){if($("#"+editor).length<=0)return!1;contentNavigator.insertContent(editor,html)}else if("exmcode"==type){var ed=eval("exmCode"+editor.charAt(0).toUpperCase()+editor.slice(1));ed.insertText(code)}},getEditorSelection:function(editor,type){if("tiny"==type){if(void 0==tinyMCE)return!1;var text=ed.selection.getContent();return text}if("markdown"==type){if(void 0==typeof mdEditor)return!1;var currentText=mdEditor.selection(editor);return currentText}if("html"==type){if(void 0==typeof edInsertContent)return!1;var text=edGetSelection(editor);return text}if("simple"==type){if($("#"+editor).length<=0)return!1;var text=contentNavigator.getSelection(editor);return text}if("exmcode"==type){var ed=eval("exmCode"+editor.charAt(0).toUpperCase()+editor.slice(1)),text=ed.selection().text;return text}},expand:function(e){if(void 0!=$(e).data("parent")||"root"==$(e).data("parent")){var t=$(e).find("ul");if(!(t.length<=0)){var o=$("#docs-resource-index .docs-index .expanded").not($(e));o.length>0&&($(o).find("ul").slideUp("fast"),$(o).removeClass("expanded")),$(e).toggleClass("expanded"),$(t).slideToggle("fast")}}},toggleSummary:function(){$("html").toggleClass("with-index"),$("html").hasClass("with-index")?$.cookie("docsindex",1,{expires:30,path:"/"}):$.removeCookie("docsindex",{path:"/"})}};$(document).ready(function(){window.onpopstate=function(e){contentNavigator.navigate(window.location.href,!1)},$("body").on("click","#docs-resource-index .docs-index a, .docs-content-inner a, .docs-content-article .document-navigation a",function(){if("_blank"!=$(this).attr("target")){if("external"==$(this).attr("rel"))return void $(this).attr("target","_blank");if("#"==$(this).attr("href").substring(0,1)){var e=$(this).attr("href");return $(e)&&$("#docs-resource-content > .docs-content-article").animate({scrollTop:$(e).offset().top},150),$(".note-touched").removeClass("note-touched"),"#note"==e.substring(0,5)&&$(e).addClass("note-touched"),!1}var t=docsUrl.replace(xoUrl,"");return t!=$(this).attr("href").substring(0,t.length)&&-1>=$(this).attr("href").indexOf(docsUrl)?void $(this).attr("target","_blank"):(contentNavigator.navigate($(this).attr("href"),!0),!1)}}),contentNavigator.navigate(window.location.href,!1),$(".note-link").click(function(){var e=$(this).attr("href").replace("#note-","");$("#note-"+e).effect("highlight",{},5e3)}),$("body").on("click",".toggle-summary",function(){return contentNavigator.toggleSummary(),!1}),$("body").on("click",".toggle-align",function(){var e="align-"+$(this).data("align");return $("html").hasClass(e)?void 0:($("html").removeClass("align-left align-center align-justify").addClass(e),$.cookie("docu_align",$(this).data("align"),{expires:30,path:"/"}),!1)}),$("body").on("click","#dialog-search",function(){var e=$("#dialog-uname").val();if(""==e)return $("#dialog-uname").focus().parent().addClass("has-error"),$(this).removeClass("btn-default").addClass("btn-danger"),contentNavigator.dialogMessage("link-dialog",docsLang.errorUser,"danger"),!1;$("#dialog-uname").focus().parent().removeClass("has-error"),$(this).addClass("btn-default").removeClass("btn-danger"),$(this).find(".fa").removeClass("fa-search").addClass("fa-spinner fa-pulse");var t={CUTOKEN_REQUEST:$("#cu-token").val(),user:e,action:"link-resources",editor:$("#link-dialog .sections-list").data("editor"),type:$("#link-dialog .sections-list").data("type")};$.post("sections.php",t,function(e){cuHandler.retrieveAjax(e)&&$("#link-dialog .modal-body").html(e.content)},"json")}),$("body").on("click","#link-dialog .books-list a",function(){var e=$(this).data("id"),t=$(this).data("owner"),o=$(this);if(0>=e||void 0==e||void 0==t||""==t)return contentNavigator.dialogMessage("link-dialog",docsLang.errorData,"danger"),!1;var n={user:t,id:e,CUTOKEN_REQUEST:$("#cu-token").val(),action:"link-resources",editor:$("#link-dialog .sections-list").data("editor"),type:$("#link-dialog .sections-list").data("type")};return o.find(".icon-book").removeClass("icon icon-book").addClass("fa fa-spinner fa-pulse"),$.post("sections.php",n,function(e){cuHandler.retrieveAjax(e)&&$("#link-dialog .modal-body").html(e.content)},"json"),!1}),$("body").on("click","#link-dialog .sections-list a",function(){var link=$(this).data("link"),title=$(this).data("title");if(void 0==link||""==link)return!1;var type=$("#link-dialog .sections-list").data("type"),editor=$("#link-dialog .sections-list").data("editor");if(void 0==type||""==type||void 0==editor||""==editor)return contentNavigator.dialogMessage("link-dialog",docsLang.noType,"danger"),!1;if("tiny"==type){if(void 0==tinyMCE)return contentNavigator.dialogMessage("link-dialog",docsLang.errorMD,"danger"),!1;var ed=tinyMCE.activeEditor,html='<a href="'+link+'">%s</a>',text=ed.selection.getContent();html=void 0==text||""==text?html.replace("%s",title):html.replace("%s",text),ed.execCommand("mceInsertContent",!0,html),ed.save()}else if("markdown"==type){if(void 0==typeof mdEditor)return contentNavigator.dialogMessage("link-dialog",docsLang.errorMD,"danger"),!1;var currentText=mdEditor.selection(editor),md="[%]("+link+")";mdEditor.insert(editor,md,title)}else if("html"==type){if(void 0==typeof edInsertContent)return contentNavigator.dialogMessage("link-dialog",docsLang.errorMD,"danger"),!1;var text=edGetSelection(editor),html='<a href="'+link+'">%s</a>';html=void 0==text||""==text?html.replace("%s",title):html.replace("%s",text),edInsertContent(editor,html)}else if("simple"==type){if($("#"+editor).length<=0)return contentNavigator.dialogMessage("link-dialog",docsLang.errorMD,"error"),!1;var text=contentNavigator.getSelection(editor),html='<a href="'+link+'">%s</a>';html=void 0==text||""==text?html.replace("%s",title):html.replace("%s",text),contentNavigator.insertContent(editor,html)}else if("exmcode"==type){var ed=eval("exmCode"+editor.charAt(0).toUpperCase()+editor.slice(1)),text=ed.selection().text,code="[url="+link+"]%s[/url]";code=void 0==text||""==text?code.replace("%s",title):code.replace("%s",text),ed.insertText(code)}$("#link-dialog").modal("hide")}),$("body").on("click","#notes-dialog .dialog-commands a.show-creator, #notes-dialog .notes-creator .btn-default",function(){$("#notes-dialog").toggleClass("creator"),$("#notes-dialog .notes-creator .note-content").focus()}),$("body").on("click","#notes-dialog .notes-creator .create-note",function(){var e=$("#notes-dialog .notes-creator .note-content");if(e.length<=0)return contentNavigator.dialogMessage("notes-dialog",docsLang.invalidNote,"danger"),!1;if(""==e.val())return contentNavigator.dialogMessage("notes-dialog",docsLang.missingNote,"danger"),!1;var t={text:e.val(),CUTOKEN_REQUEST:$("#cu-token").val(),action:"save-note",id:$("#notes-dialog .notes-creator").data("id")};$.post("sections.php",t,function(e){if(cuHandler.retrieveAjax(e)){var t=$("#notes-dialog .dialog-commands").data("editor"),o=$("#notes-dialog .dialog-commands").data("type");contentNavigator.insertIntoEditor(t,o,"[note id="+e.note+"] "),$("#notes-dialog").modal("hide")}},"json")}),$("body").on("click","#notes-dialog .notes-list .insert-note",function(){var e=$(this).data("id");if(void 0==e||0>=e)return!1;var t=$("#notes-dialog .dialog-commands").data("editor"),o=$("#notes-dialog .dialog-commands").data("type");contentNavigator.insertIntoEditor(t,o,"[note id="+e+"] "),$("#notes-dialog").modal("hide")}),$("body").on("click","#notes-dialog a[data-page]",function(){var e=$(this).data("page");if(0>=e)return!1;var t=$("#notes-dialog .dialog-commands").data("editor"),o=$("#notes-dialog .dialog-commands").data("type"),n=$("#notes-dialog .dialog-commands").data("id"),i={id:n,page:e,editor:t,type:o,CUTOKEN_REQUEST:$("#cu-token").val(),action:"insert-notes"};return $(this).html('<span class="fa fa-spinner fa-spin"></span>'),$.post("sections.php",i,function(e){return cuHandler.retrieveAjax(e)?($("#notes-dialog .modal-body").html(e.content),!1):void 0},"json"),!1}),$("body").on("click","#notes-dialog .search-box .btn",function(){var e=$("#notes-dialog .search-box > input").val();if(void 0==e||""==e)return!1;var t=$("#notes-dialog .dialog-commands").data("editor"),o=$("#notes-dialog .dialog-commands").data("type"),n=$("#notes-dialog .dialog-commands").data("id"),i={id:n,search:e,editor:t,type:o,CUTOKEN_REQUEST:$("#cu-token").val(),action:"insert-notes"};return $(this).html('<span class="fa fa-spinner fa-spin"></span>'),$.post("sections.php",i,function(e){return cuHandler.retrieveAjax(e)?($("#notes-dialog .modal-body").html(e.content),!1):void 0},"json"),!1}),$("#docs-resource-index").length&&$("#docs-resource-index").perfectScrollbar(),$("#docs-resource-index .docs-index li a").click(function(){contentNavigator.expand($(this).parent())}),$("#docs-resource-index .quick-search input").keyup(function(e){if(13!=e.which)return!1;if($(this).val().length<3)return $("#docs-resource-index > .no-results").slideUp("fast"),$("#docs-resource-index > .results-index").remove(),$("#docs-resource-index > .docs-index").fadeIn("fast"),!1;var t=$(this).val(),o=[];if($("#docs-resource-index ul > li > a").each(function(){$(this).text().search(new RegExp(t,"i"))>=0&&(o[o.length]=$(this).clone())}),o.length<=0)return $("#docs-resource-index > .no-results").slideDown("fast"),!1;$("#docs-resource-index > .docs-index").fadeOut("fast");for(var n=$("<ul/>").addClass("results-index"),i=0;i<o.length;i++)$(n).append(o[i]);$("#docs-resource-index").append(n)})});
